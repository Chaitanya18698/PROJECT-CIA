<div class="page-container">
  <div class="page-header">
    <div class="page-header-title">
      <a class="page-header-title-icon" (click)="backToUrl()">
        <i class="fa-solid fa-chevron-left"></i>
      </a>
      <div class="page-title">
        <div class="title">Add User</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <form novalidate role="form" autocomplete="off" [formGroup]="clientForm">
        <div class="row">
          <div class="col-md-4">
            <div class="form-group">
              <label for="id-generation" class="form-label field-required"
                >Generate ID</label
              >
              <input
                id="id-generation"
                type="text"
                class="form-control"
                placeholder="Enter ID"
                name="userId"
                formControlName="display_id"
                ngClass="{'is-invalid': clientForm.controls['userId'].invalid && (clientForm.controls['userId'].touched || clientForm.controls['userId'].dirty)}"
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  clientForm.controls['display_id'].invalid &&
                  (clientForm.controls['display_id'].touched ||
                    clientForm.controls['display_id'].dirty)
                "
              >
                <span
                  *ngIf="clientForm.controls['display_id']?.errors.required"
                >
                  Please provide an ID.
                </span>
                <span
                  *ngIf="clientForm.controls['display_id']?.errors.maxlength"
                >
                  ID should be atleast 2 characters.
                </span>
                <span
                  *ngIf="clientForm.controls['display_id']?.errors.minlength"
                >
                  ID should not be more than 10 characters.
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label for="username" class="form-label field-required"
                >Username</label
              >
              <input
                id="username"
                type="text"
                class="form-control"
                placeholder="Enter username"
                name="userName"
                formControlName="name"
                ngClass="{'is-invalid': clientForm.controls['name'].invalid && (clientForm.controls['name'].touched || clientForm.controls['name'].dirty)}"
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  clientForm.controls['name'].invalid &&
                  (clientForm.controls['name'].touched ||
                    clientForm.controls['name'].dirty)
                "
              >
                <span *ngIf="clientForm.controls['name']?.errors.required">
                  Username is required.
                </span>
                <span *ngIf="clientForm.controls['name']?.errors.maxlength">
                  Username should be atleast 2 characters.
                </span>
                <span *ngIf="clientForm.controls['name']?.errors.minlength">
                  Username should not be more than 100 characters.
                </span>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="form-group">
              <label for="password" class="form-label field-required"
                >password</label
              >
              <input
                id="password"
                type="text"
                class="form-control"
                placeholder="Enter password"
                name="password"
                formControlName="password"
                ngClass="{'is-invalid': clientForm.controls['password'].invalid && (clientForm.controls['password'].touched || clientForm.controls['password'].dirty)}"
              />
              <div
                class="invalid-feedback"
                *ngIf="
                  clientForm.controls['password'].invalid &&
                  (clientForm.controls['password'].touched ||
                    clientForm.controls['password'].dirty)
                "
              >
                <span *ngIf="clientForm.controls['password']?.errors.required">
                  password is required.
                </span>
                <span *ngIf="clientForm.controls['password']?.errors.maxlength">
                  password should be atleast 2 characters.
                </span>
                <span *ngIf="clientForm.controls['password']?.errors.minlength">
                  Username should not be more than 100 characters.
                </span>
              </div>
            </div>
          </div>
          <!-- <div class="col-md-12">
            <div class="row">
              <div class="col-md-4">
                <div class="form-group">
                  <label for="Generate for" class="form-label field-required">Generate For</label>
                  <div class="radio">
                    <input type="radio" name="generate-for" id="implementor" />
                    <label for="implementor">Implementor</label>
                  </div>
                  <div class="radio">
                    <input type="radio" name="generate-for" id="client" />
                    <label for="client">Client</label>
                  </div>
                </div>
              </div>
            </div>
          </div> -->
          <ng-container formArrayName="priv">
            <div
              class="col-md-12"
              *ngFor="let clientIndex of priv.controls; let i = index"
            >
              <div
                class="row form-group"
                [formGroupName]="i"
                [ngClass]="{ 'border-bottom': i + 1 != priv.controls.length }"
              >
                <!-- <div class="col-md-4">
                <div class="form-group">
                  <label for="username" class="form-label field-required">Select Implementor</label>
                  <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                      (click)="onOpenForm('implementors')">
                      {{
                      selectedImplementor
                      ? selectedImplementor
                      : "Select Implementor"
                      }}
                      <div class="clear" (click)="clear(selectedImplementor, $event)" *ngIf="selectedImplementor != ''">
                        <i class="fa-solid fa-times"></i>
                      </div>
                      <div class="clear" (click)="clear(selectedImplementor, $event)" *ngIf="selectedImplementor != ''">
                        <i class="fa-solid fa-times"></i>
                      </div>
                    </a>

                    <div class="dropdown-menu">
                      <ul>
                        <li *ngFor="let item of implementationList; let i = index" [ngClass]="{
                            active: item.itemName == selectedImplementor
                          }">
                          <a class="dropdown-item" (click)="selectImplementor(item)">
                            {{ item.itemName }}
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                  <div class="invalid-feedback" *ngIf="
                      clientForm.controls['implementors'].invalid &&
                      (clientForm.controls['implementors'].touched ||
                        clientForm.controls['implementors'].dirty)
                    ">
                    <span *ngIf="
                        clientForm.controls['implementors']?.errors.required
                      ">
                      Implementor is required.
                    </span>
                  </div>
                  <div></div>
                </div>
              </div> -->
                <!-- Client -->
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="client" class="form-label field-required"
                      >Select Client</label
                    >
                    <!-- <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" (click)="onOpenForm('client')">
                      {{ selectedClient ? selectedClient : "Select Client" }}
                      <div class="clear" (click)="clear('Client', $event)" *ngIf="selectedClient != ''">
                        <i class="fa-solid fa-times"></i>
                      </div>
                    </a>

                    <div class="dropdown-menu">
                      <ul>
                        <li *ngFor="let item of clientsList; let i = index" [ngClass]="{
                            active: item.itemName == selectedClient
                          }">
                          <a class="dropdown-item" (click)="selectClient(item)">
                            {{ item.itemName }}
                          </a>
                        </li>
                      </ul>
                    </div>
                  </div> -->
                    <akv-single-select
                      [optionList]="clientsList"
                      placeholder="select client"
                      formControlName="client_id"
                    ></akv-single-select>
                    <!-- <div
                      class="invalid-feedback"
                      *ngIf="
                        clientIndex.controls['client_id'].invalid &&
                        (clientIndex.controls['client_id'].touched ||
                          clientIndex.controls['client_id'].dirty)
                      "
                    >
                      <span
                        *ngIf="clientIndex.controls['client_id']?.errors.required"
                      >
                        Client is required.
                      </span>
                    </div> -->
                  </div>
                </div>
                <!-- Modules -->
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="module{{ i }}" class="form-label field-required"
                      >Select Module</label
                    >
                    <!-- <div class="dropdown multi-dropdown">
                    <a type="button" id="multiSelect" data-bs-hover="dropdown" data-bs-toggle="dropdown"
                      aria-haspopup="true" aria-expanded="true" class="dropdown-toggle">
                      <div class="multi-selective">
                        <div class="badge-white-filter">
                          <span class="text-truncate multi-select-text">
                            Default </span><a name="filter_badge"><i class="fa-solid fa-times"></i></a>
                        </div>
                      </div>
                    </a>
                    <div aria-labelledby="multiSelect" class="dropdown-menu is-no-scroll">
                      <div class="multi-search">
                        <div class="input-group input-group-both">
                          <div class="input-group-prepend">
                            <span class="input-group-text"><i class="fa-solid fa-search"></i></span>
                          </div>
                          <input autocomplete="off" type="text" placeholder="Search"
                            class="form-control ng-valid ng-dirty ng-touched" />
                          <div class="input-group-append">
                            <span class="input-group-text"></span>
                          </div>
                        </div>
                      </div>
                      <div class="multi-selection">
                        <div class="checkbox-wrap">
                          <input autocomplete="off" type="checkbox" id="mselect-kjn1x28n9-all"
                            class="ng-untouched ng-valid ng-dirty" /><label for="mselect-kjn1x28n9-all">Unselect
                            All</label>
                        </div>
                      </div>
                      <ul>
                        <li class="dropdown-item" *ngFor="let item of modulesList; let i = index">
                          <div class="checkbox-wrap">
                            <input autocomplete="off" type="checkbox" id="mselect-kjn1x28n9-1" /><label
                              for="mselect-kjn1x28n9-1"><span class="break-word">Default</span></label>
                          </div>
                        </li>
                      </ul>
                    </div>
                  </div> -->
                    <akv-multi-select
                      [optionList]="modulesList"
                      placeholder="select modules"
                      id="module{{ i }}"
                      formControlName="modules"
                    ></akv-multi-select>
                    <!-- <div
                      class="invalid-feedback"
                      *ngIf="
                        clientIndex.controls['modules'].invalid &&
                        (clientIndex.controls['modules'].touched ||
                          clientIndex.controls['modules'].dirty)
                      "
                    >
                      <span
                        *ngIf="clientIndex.controls['modules']?.errors.required"
                      >
                        Module is required.
                      </span>
                    </div> -->
                  </div>
                </div>
                <div
                  class="col-md-12 form-group text-end"
                  *ngIf="parent_id != 'users'"
                >
                  <button
                    class="btn btn-xs btn-icon btn-tertiary btn-red"
                    (click)="removeForm(i)"
                  >
                    Delete
                  </button>
                  <button
                    class="btn btn-xs btn-icon btn-tertiary"
                    *ngIf="i == priv.length - 1"
                    (click)="addaOneMore()"
                  >
                    Add
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </form>
    </div>
    <div class="card-footer">
      <button class="btn btn-tertiary-gray">Cancel</button>
      <button class="btn btn-primary" (click)="checkValidation()">
        Submit
      </button>
    </div>
  </div>
</div>
